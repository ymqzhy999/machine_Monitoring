# 设备效能监控系统 - 核心架构设计

## 项目概述

设备效能监控系统是一个基于Python Flask的Web应用，用于实时监控和分析生产设备的运行状态、效率指标和质量数据。系统通过采集和处理设备运行数据、人员操作记录、物料消耗及环境参数，实现对生产过程的全面监控和分析，提供决策支持。

## 系统架构

### 1. 整体架构

系统采用经典的三层架构：
- 表现层：基于Flask的Web界面，包括各种数据可视化图表
- 业务逻辑层：数据处理、指标计算和分析算法
- 数据层：包括内存缓存和文件存储

### 2. 核心模块

系统包含以下核心模块：
- **数据采集模块**：支持从CSV、Excel文件导入生产数据
- **数据处理模块**：清洗、转换和标准化原始数据
- **指标计算模块**：计算OEE、可用性、性能效率等关键指标
- **实时监控模块**：显示设备当前状态和预警信息
- **分析预测模块**：提供历史趋势分析和简单预测
- **API接口**：提供JSON格式的数据供前端访问

## 数据模型

系统基于四类主要数据：

1. **设备数据**：记录设备ID、时间戳、设备状态、运行时间、故障次数等
2. **物料数据**：记录日期、物料编号、产品数量、合格产品数量等
3. **人员操作数据**：记录工号、时间戳、设备ID、操作类型、操作时长、操作结果等
4. **环境数据**：记录传感器ID、时间戳、温度、湿度、PM2.5、位置等

## 核心算法与思路

### 1. OEE计算

OEE（设备综合效率）是衡量设备效能的核心指标，通过可用性、性能效率和质量三个维度的乘积计算得出：

```
OEE = (可用性 × 性能效率 × 质量) / 10000
```

系统根据实际数据计算这三个维度，或在缺少数据时使用合理的默认值和估算方法。

### 2. 缓存策略

系统采用多级缓存策略提高性能：
- 指标缓存：将计算过的设备指标缓存一定时间，避免重复计算
- 响应缓存：缓存API响应结果，减少重复计算
- 自动清理：定期清理过期缓存数据

### 3. 数据处理原则

- **数据验证**：验证导入数据的完整性和有效性
- **缺失值处理**：对缺失数据使用默认值或基于历史数据估算
- **异常检测**：识别并标记数据中的异常点
- **数据一致性**：确保不同来源数据的时间和设备标识一致

### 4. 可视化策略

- **多维展示**：从效率、时间、质量、资源和瓶颈多个维度展示数据
- **趋势分析**：展示关键指标的历史变化趋势
- **对比分析**：不同设备、不同时间段的指标对比
- **异常突出**：预警和异常数据的突出显示

## 设计模式与实践

### 1. 工厂模式

使用工厂模式生成不同类型的分析报告和指标数据，便于扩展新的分析维度。

### 2. 观察者模式

实现设备状态变化的监控和通知机制，当设备状态发生重要变化时触发相应处理。

### 3. 策略模式

针对不同数据类型和分析目标，采用不同的处理策略，保持接口一致性。

### 4. 模拟数据生成

系统包含完善的模拟数据生成机制，在实际数据不足时提供合理的测试数据，支持:
- 基于真实数据模式生成相似数据
- 随机生成符合业务规则的数据
- 支持不同数据量级和复杂度的生成

## 可扩展性设计

系统设计考虑了以下扩展点：

1. **新数据源集成**：系统可以方便地扩展支持新的数据源类型
2. **新指标计算**：可以添加新的效能指标和计算方法
3. **新分析维度**：支持添加新的分析视角和报表类型
4. **实时数据处理**：架构支持未来扩展为实时数据流处理

## 高可用性设计

1. **容错机制**：对数据处理和计算过程中的异常有完善的处理
2. **降级服务**：在数据不完整时提供基于估算的降级服务
3. **缓存恢复**：系统重启后能够快速恢复关键数据缓存

## 核心业务流程

1. **数据采集流程**：从文件导入或API接收数据 -> 数据验证 -> 数据转换 -> 存储
2. **指标计算流程**：原始数据 -> 数据过滤 -> 维度计算 -> 指标合成 -> 缓存 -> 展示
3. **分析报告流程**：用户请求 -> 参数验证 -> 数据查询 -> 指标计算 -> 数据可视化 -> 返回结果

## 技术栈

- **后端框架**：Python Flask
- **数据处理**：Pandas, NumPy
- **数据可视化**：使用前端库处理JSON数据
- **数据存储**：文件系统(Excel)，内存缓存
- **API设计**：RESTful API，JSON格式 